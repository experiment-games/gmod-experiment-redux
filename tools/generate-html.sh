#!/bin/bash

HTML_DIR="./html"
OUTPUT_FILE="./schema/cl_html.generated.lua"

# Header to warn users not to edit the file
echo "-- ! WARNING: THIS FILE IS AUTOMATICALLY GENERATED" > "$OUTPUT_FILE"
echo "-- ! DO NOT EDIT IT, YOUR CHANGES WILL BE OVERRIDDEN" >> "$OUTPUT_FILE"
echo "return {" >> "$OUTPUT_FILE"

for html_file in "$HTML_DIR"/*.html; do
    filename=$(basename "$html_file")
    echo "   [\"$filename\"] = [[" >> "$OUTPUT_FILE"

    # Append file contents, escaping sequences that need to be literal
    while IFS= read -r line; do
        echo "      $line" >> "$OUTPUT_FILE"
    done < "$html_file"

    echo "   ]]," >> "$OUTPUT_FILE"
done

echo "}" >> "$OUTPUT_FILE"
